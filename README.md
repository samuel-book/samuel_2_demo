# SAMueL-2 Demo

Replication of Stroke Audit Machine Learning with artificial patient data.


## Run on Binder

You may run the notebooks on Binder. If it hasn't been used for a while it make take about 5 mins to initialise.

[![Binder](https://mybinder.org/badge_logo.svg)](https://mybinder.org/v2/gh/samuel-book/samuel_2_demo/main)

## What is here?

These examples replicate key work from the SAMueL (Stroke Audit Machine Learning) project. Examples cover.

1) Choice of use of thrombolysis at each stroke team.

2) The effect of three possible changes to stroke pathways for each team:
    * Change pathway speed to 30 minutes arrival-to-thrombolysis for 95% of patients (15 min arrival-to-scan, 15 min scan-to-thrombolysis). We assume 5% of patients will be atypical and will not receive a scan within time for thrombolysis.
    * Change the proportion of patients with known onset time to the national upper quartile across stroke teams, if currently lower than that.
    * For those scanned in time to thrombolyse, apply a *benchmark* thrombolysis rate. This is the expected use of thrombolysis in the stroke team's own patient populations if decisions for each patient were made by a majority vote of 25 *benchmark* stroke teams which are the stroke teams with the highest willingness to use thrombolysis (predicted to have the highest use of thrombolysis if all stroke teams saw the same patients). *Benchmark teams* are predicted to have better outcomes (add reference when available).
    * A combination of above.

3) Predicted outcomes for patients with and without thrombolysis.

Both sets of models are for patients arriving within 4 hours of known stroke onset (onset time may be known precisely, or may have been estimated).

## Artificial patient data

Artificial data made available here is produced by sampling patient attributes separately from real patient data (using bootstrap sampling with replacement, and rounding/censoring process times and ages). Each artificial patient here is therefore a composite of data from real patients (after rounding/censoring data), and may sometimes combine combinations of patient features that are not realistic of real patients. For machine learning data, the use of thrombolysis and the outcome data was generated by machine learning models predicting use of thrombolysis and outcome for that individual artificial patient. This data allows demonstration of the models, maintain many of the relationships between patient characteristics and use/outcome of thrombolysis, but should never be used for clinical research into stroke or for guidance on clinical decision-making.

### Data for Machine Learning

Artificial patient data is created by sampling feature values (with replacement, and with rounding/censoring as appropriate) independently. Sampling is performed for each stroke team. These data do not maintain covariances in the original data (except that stroke severity distributions are created separately for ischaemic and non-ischaemic stroke patients). The sampled data did not include actual use of thrombolysis or outcomes (disability/death after stroke); artificial patient data was passed to models to predict probabilities of patients receiving thrombolysis, and then passed to a model to predict disability (mRS) on discharge from inpatient care. Use of thrombolysis and outcomes were sampled from distributions based on probability outputs from the ML models, and these outputs added to the artificial patients. While the artificial data does not maintain covariance of features, the labelling with use of thrombolysis and outcome will maintain interactions between features.

These artificial patients are intended to demonstrate our machine learning models, and are not suitable for any clinical research into stroke. Each artificial patient has the following features.

* Stroke team (anonymised)
* Infarction (Y/N)
* Age (5 year age bands, with ages censored below 35 or above 95
* Disability prior to stroke (modified Rankin Scale, mRS)
* Onset-to-arrival time (minutes, rounded to closest 5 mins)
* Arrival-to-scan time (minutes, rounded to closest 5 mins)
* Scan-to-thrombolysis time (minutes, if appropriate, rounded to closest 5 mins)
* Onset-to-thrombolysis time (calculated, if appropriate)
* Onset time known precisely (Y/N)
* Onset during sleep (all are then labelled as having imprecise onset times)
* Stroke Severity (NIHSS)
    Stroke severity is sampled separately for ischaemic and non-ischaemic strokes
* Atrial fibrillation coagulant treatment (with a corresponding diagnosis of atrial fibrillation)

Stroke teams have been anonymised, and all stroke teams have 500 artificial patients generated.


### Data for pathway model

The artificial_patient_pathway_data is generated in a similar way: For each feature the required data is sampled (with replacement, and with rounding/censoring as appropriate) independently. Sampling on whether a patient receives thrombolysis or not is sampled from only those real patients who arrived within 4 hours of known onset, were scanned within 4 hrs 15 mins of known onset, and had ischaemic strokes. Again, these artificial patients are intended to demonstrate our simulation model, and are not suitable for any clinical research into stroke. Each artificial patient has the following features.

* Stroke team (anonymised)
* Arrive by ambulance (Y/N)
* Age (5 year age bands, with ages censored below 35 or above 95)
* Infarction (Y/N)
* Onset known (Y/N)
* Onset-to-arrival time (minutes, rounded to closest 5 mins)
* Arrival-to-scan time (minutes, rounded to closest 5 mins)
* Use of thrombolysis (Y/N)
* Scan-to-thrombolysis time (minutes, if appropriate, rounded to closest 5 mins)

Stroke teams are the same teams as the artificial ML data. 500 patients have been generated per team.


## Environment

A `environment.yml` file is provided in the `binder` folder. A summary of the packages used is:

* Python 3.10
* Matplotlib 3.8
* NumPy 1.26
* Pandas 2.1
* Scikit-Learn 1.3
* SHAP 0.43
* XGBoost 2.0